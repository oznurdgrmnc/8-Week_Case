-- 1. What is the total amount each customer spent at the restaurant?

SELECT 
	s.customer_id,
    SUM(m.price) AS totalprice
FROM sales s
JOIN menu m 
ON s.product_id = m.product_id
GROUP BY s.customer_id;

--
-- 2. How many days has each customer visited?

SELECT 
	customer_id,
	COUNT(DISTINCT order_date) AS freq
FROM sales
GROUP BY customer_id;

--
-- 3. What was the first item from the menu purchased by each customer?

WITH cte_order_rank AS (
	SELECT
		s.customer_id,
		s.order_date,
		m.product_name,
		DENSE_RANK() OVER (PARTITION BY s.customer_id ORDER BY s.order_date) as order_ranks
	FROM sales s
	JOIN menu m 
	ON s.product_id = m.product_id
	)
SELECT
	customer_id,
	product_name
FROM cte_order_rank
WHERE order_ranks = '1'
GROUP BY customer_id, product_name;

--
-- 4. What is the most purchased item on the menu and how many times was it purchased by all customers?

SELECT
	m.product_name,
	COUNT(s.product_id) as product_count
FROM sales s
JOIN menu m
ON s.product_id = m.product_id
GROUP BY product_name
ORDER BY product_count DESC
LIMIT 1;

--
-- 5. Which item was the most popular for each customer?

WITH cte_popular AS (
	SELECT
		s.customer_id,
		COUNT(s.product_id) as order_count,
		m.product_name,
		DENSE_RANK() OVER (PARTITION BY s.customer_id, ORDER BY order_count desc) AS ranks
	FROM sales s
	JOIN menu m
	ON s.product_id = m.product_id
	GROUP BY s.customer_id, m.product_name
	)
SELECT
	customer_id,
	product_name
FROM cte_popular
WHERE ranks = 1;

--
-- 6. Which item was purchased first by the customer after they became a member?




















